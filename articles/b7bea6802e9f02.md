---
title: "Goã¨50%ãã‚‰ã„ã®ç†è§£ã§ã¯ã˜ã‚ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã¨ã„ã†ã‹ã‚ªãƒ‹ã‚ªãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"
emoji: "ğŸ§…"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£", "ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£", "ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£", "test"]
published: true
---

ç©èª­ã—ã¦ã„ãŸ[Clean Architectureæœ¬](https://www.amazon.co.jp/Clean-Architecture-%E9%81%94%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E6%A7%8B%E9%80%A0%E3%81%A8%E8%A8%AD%E8%A8%88-Robert-C-Martin/dp/4048930656)ã‚’èª­äº†ã—ãŸã®ã§ã™ãŒã€ã„ã¾ã„ã¡å®Ÿè·µçš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸æ¹§ã‹ãªã‹ã£ãŸãŸã‚ã€ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Ÿéš›ã«Goã§å®Ÿè£…ã—ãŸã¨ã„ã†è©±ã§ã™ã€‚

:::message
è‘—è€…ã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚„ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦ã¯å­¦ç¿’ã—ãŸã°ã‹ã‚Šã§ã€ç†è§£ã¨ã—ã¦é©åˆ‡ã§ã¯ãªã„èª¬æ˜ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ä»Šå›ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã¯ã˜ã‚ã‚‹ã‚¯ãƒªãƒ¼ãƒ³(ã‚ªãƒ‹ã‚ªãƒ³)ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚ã‚ã‚‹ã‚ˆã¨ã„ã†ç´¹ä»‹ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ãŒã€ã‚‚ã—é–“é•ã£ãŸç†è§£ã€ä¸é©åˆ‡ãªç®‡æ‰€ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãªã©ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ğŸ™‡
:::

## æƒ³å®šèª­è€…

- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å­¦ç¿’ã—ãŸã‘ã©ã„ã¾ã„ã¡ãƒ”ãƒ³ã¨ã“ãªã‹ã£ãŸäºº
- Goã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Ÿè£…ã—ãŸã„äºº
- ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„äºº

## æœ¬è¨˜äº‹ã§èª¬æ˜ã—ãªã„ã“ã¨

- DDDã«ã¤ã„ã¦ã‚‚å°‘ã—è§¦ã‚Œã‚‹äºˆå®šã§ã™ãŒã€DDDã®è©³ç´°ã«ã¤ã„ã¦ã¯èª¬æ˜ã—ã¾ã›ã‚“
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©³ç´°

## ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒãªãœãƒ”ãƒ³ã¨ã“ãªã„ã®ã‹

å€‹äººçš„ãªæ„Ÿæƒ³ã§ã™ã€‚

### åŒå¿ƒå††ã®è©±ã«ãªã‚ŠãŒã¡

![](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F293368%2F7ce1fb10-504e-16e0-8930-278b8a7f942d.jpeg?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&w=1400&fit=max&s=6202c326b443ad77ae7fdf47bc9bd9d1)

å®Ÿéš›Clean Architectureæœ¬ã®ä¸­ã§ã€åŒå¿ƒå††ã‚’ç”¨ã„ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©±ã¯æ•°ãƒšãƒ¼ã‚¸ã®ã¿ã§ã™ã€‚å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€å…·ä½“çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹æˆã®è©±ã«ãªã‚ŠãŒã¡ãªãŸã‚ã‹ã¨æ€ã„ã¾ã™ãŒå°‘ãªãã¨ã‚‚Clean Architectureæœ¬ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹SOLIDåŸå‰‡ã‚„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®‰å®šåº¦ã¨æŠ½è±¡åº¦ã®è©±ã¨ã‹ã¨åŒå¿ƒå††ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©±ãªã©å«ã‚ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã„ã†æ¦‚å¿µã§ã™ã€‚(è‘—è€…ã¯ãã†ç†è§£ã—ã¾ã—ãŸã€‚)

ãã—ã¦ã€ä¸Šè¨˜ã®åŒå¿ƒå††ã§é‡è¦ãªã“ã¨ã¯ä»¥ä¸‹ã®2ç‚¹ã§ã‚ã‚‹ã¨ã‚ˆãè¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚

- **ä¾å­˜é–¢ä¿‚ã¯å¤–å´ã‹ã‚‰å†…å´ã¸ã®ä¸€æ–¹å‘ã®ã¿ã«å‘ã‹ã†**
- **å†…å´ã‹ã‚‰å¤–å´ã¸ã®ä¾å­˜ã¯ä¾å­˜é–¢ä¿‚é€†è»¢ã®åŸå‰‡ã«ã—ãŸãŒã†ã“ã¨ã§å®Ÿç¾ã™ã‚‹**

ãã®ãŸã‚ã€åŒå¿ƒå††ã®ã‚ˆã†ãª4å±¤ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã§ãªãã¨ã‚‚è‰¯ã„ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã—ã€ãã®åç§°ãªã©ã‚‚ãã“ã¾ã§é‡è¦ã§ã¯ã¨æ¨å¯Ÿã§ãã¾ã™ã€‚

æ—¢ã«ã„ã‚ã‚“ãªã¨ã“ã‚ã§è¨€ã‚ã‚Œã¦ã„ã¾ã™ãŒã‚ã¾ã‚ŠåŒå¿ƒå††ã«ã“ã ã‚ã‚Šã™ããªã„æ–¹ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ´»ç”¨ã—ã¦ã„ã‘ã‚‹ã®ã§ã¯ãªã„ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚

### åç§°ã«æƒ‘ã‚ã•ã‚Œã‚‹

ä¸Šè¿°ã—ãŸåŒå¿ƒå††ã®ä¸­å¿ƒã«ã¯**ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**ãŒå­˜åœ¨ã—ã¾ã™ãŒã€DDD(ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•é–‹ç™º)ã®æ–‡è„ˆã§ã‚‚ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã„ã†åç§°ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®äºŒã¤ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¡¨ç¾ã™ã‚‹ã¨ã„ã†ç‚¹ã§ã¯ã¾ã£ãŸãã®åˆ¥ç‰©ã§ã‚‚ãªã„æ°—ãŒã™ã‚‹ã®ã§ã™ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨DDDã¨ã§ã‚„ã¯ã‚Šèª¬æ˜ã—ã¦ã„ã‚‹æ¦‚å¿µãŒé•ã†ãŸã‚ã€æ··åŒã•ã›ã‚‹ã¨æ··ä¹±ã—ã¦ã—ã¾ã†ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚(ã‚ãŸã—ã¯ã—ã¾ã—ãŸã€‚)

åŠ ãˆã¦ã€ã‚ãŸã—ã¯JVMç³»ã§ã®é–‹ç™ºã‚’ã„ã¾ã¾ã§ã—ãŸããŸãŸã‚ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦Springã‚’ä½¿ç”¨ã—ã¦ããŸã®ã§ã™ãŒã€ãã®ä¸­ã§ã‚‚Entityã‚„Repositoryã€Serviceã¨ã„ã†ç”¨èªã‚’å¤šç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ã“ã‚Œã‚‰ã‚‚ã¾ãŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚„DDDã§è¨€ã‚ã‚Œã¦ã„ã‚‹ç”¨èªã¨ã¯ç•°ãªã‚‹æ„å‘³åˆã„ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

ã‚‚ã—ã‹ã—ãŸã‚‰ã€Ruby on Railsãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ããŸæ–¹ã§ã™ã¨MVCã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨æ¯”è¼ƒã—ã€æ··åŒã—ã¦ã—ã¾ã†æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚‚ã—ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å­¦ç¿’ã™ã‚‹ä¸Šã§ä»–ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨æ··åŒã—æ··ä¹±ã—ã¦ããŸã‚‰**åç§°ã¯åŒã˜ã ãŒèª¬æ˜ã—ã¦ã„ã‚‹ã‚‚ã®ã¯é•ã†ã‹ã‚‚çŸ¥ã‚Œãªã„**ã¨ã„ã†ã“ã¨ã‚’æ„è­˜ã™ã‚‹ã¨ç†è§£ãŒé€²ã‚€ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚

ä»¥ä¸‹ã®è¨˜äº‹ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨DDDã«ã¤ã„ã¦ã¨ã¦ã‚‚ã‚ã‹ã‚Šã‚„ã™ãè§£èª¬ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ãœã²èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

https://little-hands.hatenablog.com/entry/2017/10/04/231743

### å…·ä½“çš„ãªå®Ÿè£…ä¾‹ãŒãªã„

å°‘ãªãã¨ã‚‚æœ¬æ›¸ã«ã¯ãªã„ã§ã™ã€‚èª¿ã¹ã‚Œã°ã„ãã¤ã‹è¦‹ã¤ã‹ã‚Šã¾ã™ãŒã©ã‚Œã‚‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆãŒå¾®å¦™ã«é•ã„ã¾ã™ã—ã€åç§°ã‚‚ãã‚Œãã‚Œã§è¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã‚‹å·®ç•°ã‚‚å‡ºã¦ãã¾ã™ã€‚

ã¾ãŸã€Springã¿ãŸã„ãªDIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ãªã‚‰ã‚ã¾ã‚Šè€ƒãˆãªãã¦ã‚‚ã„ã„ã®ã§ã™ãŒGoãªã©ã§å®Ÿè£…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨è‡ªåˆ†ã§DIã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ãã“ã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚‚æ¹§ã‹ãªã„ã¨å…¨ä½“çš„ãªå®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚

ä»¥ä¸‹ã®è¨˜äº‹ã¯Goã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿè£…ä¾‹ã‚’ã¾ã¨ã‚ã¦ãã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚

https://zenn.dev/naoki_kuroda/articles/8a7dc8dc10f5f9

ãªã®ã§ã€ã„ã–ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å­¦ç¿’ã‚’çµ‚ãˆã¦ã€å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã¨ãªã£ãŸã¨ãã«å›°æƒ‘ã—ã¾ã™ã€‚(ã‚ãŸã—ã¯ã—ã¾ã—ãŸã€‚)

ç¹°ã‚Šè¿”ã—ã«ãªã‚Šã¾ã™ãŒã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã„ã†ã‹ã‚ã®åŒå¿ƒå††ãŒä¸€ç•ªä¼ãˆãŸã„ã“ã¨ã¯ãŠãã‚‰ãæ¦‚å¿µçš„ãªè©±ã§åç§°ã‚„å½¢ã¯ãã‚Œã»ã©é‡è¦ã§ã¯ãªã„ãŸã‚ä¸€ç•ªãƒ”ãƒ³ã¨ããŸæ§‹æˆã§ã‚„ã‚‹ã®ãŒã„ã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

## ãã“ã§ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å­¦ã‚“ã§ãƒ”ãƒ³ã¨ããŸæ–¹ã¯ãã®ã¾ã¾ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ä½¿ç”¨ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚ãŸã ã€ã‚‚ã—ã‚ãŸã—ã¨åŒã˜ã‚ˆã†ã«**ãªã‚“ã¨ãªãç†è§£ã—ãŸã‘ã©å…·ä½“çš„ãªå®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ã‹ãªã„**ã¨ã„ã†æ–¹ã¯**ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã®æ–¹ãŒãƒ”ãƒ³ã¨ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã¯

2008å¹´ã«Jeffery PalermoãŒä»¥ä¸‹ã®è¨˜äº‹ã§æå”±ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ã€‚è‹±èªã§ã™ãŒæ–‡é‡ã¯ãã“ã¾ã§å¤šããªã„ã®ã§èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯èª­ã‚“ã§ã¿ã‚‹ã¨ãŠã‚‚ã—ã‚ã„ã¨æ€ã„ã¾ã™ã€‚

https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/

ä»¥ä¸‹ã®è¨˜äº‹ãŒå¤§å¤‰ã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ã“ã¡ã‚‰ã‚’å‚ç…§ã€‚

https://qiita.com/little_hand_s/items/2040fba15d90b93fc124

### ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã ã¨ä½•ãŒã†ã‚Œã—ã„ã®ã‹

![](https://storage.googleapis.com/zenn-user-upload/ce0f5d3bbec0-20230516.webp)

ã“ã‚Œã‚‚ã„ã‚ã‚“ãªã¨ã“ã‚ã§è¨€ã‚ã‚Œã¦ã„ã¾ã™ãŒã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚åŸºæœ¬çš„ãªæ¦‚å¿µã¯ä¸€ç·’ã§ã™ã€‚ã©ã¡ã‚‰ã‚‚ç›®çš„ã¯é–¢å¿ƒã”ã¨ã®åˆ†é›¢ã§ã™ã€‚

ä¸€å¿œã€ä¸Šè¨˜ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦æ›¸ã‹ã‚ŒãŸãƒ–ãƒ­ã‚°è¨˜äº‹å†…ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®šç¾©çš„ãªã‚‚ã®ã€‚

>Key tenets of Onion Architecture:
>- The application is built around an independent object model
>- Inner layers define interfaces. Outer layers implement interfaces
>- Direction of coupling is toward the center
>- All application core code can be compiled and run separate from infrastructure

> ã‚ªãƒ‹ã‚ªãƒ³ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸»è¦ãªè€ƒãˆæ–¹ï¼š
> - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ç‹¬ç«‹ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒ¢ãƒ‡ãƒ«ã‚’ä¸­å¿ƒã«æ§‹ç¯‰ã•ã‚Œã‚‹
> - å†…å´ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚å¤–å´ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹
> - çµåˆã®æ–¹å‘ã¯ä¸­å¿ƒã«å‘ã‹ã£ã¦ã„ã‚‹
> - ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢ã‚³ãƒ¼ãƒ‰ã¯ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã¨ã¯åˆ¥ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹

ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å›³ã«ã‚ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä¸€ç•ªå¤–å´ã«```tests```ã¨```infrastructure```ã€```user interface```ãŒã‚ã‚Šã¾ã™ã€‚testã¨DBãªã©ã®å…·ä½“çš„ãªå®Ÿè£…ãŒå«ã¾ã‚Œã‚‹infrastructureå±¤ãŒä¸€ç•ªå¤–å´ã«ã‚ã‚‹ã®ã¯ç†è§£ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

æ¬¡ã«```Application Services```ã¨```Domain(Object) Services```ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Šã€ã±ã£ã¨è¦‹é•ã„ãŒã‚ã‹ã‚Šã¾ã›ã‚“ãŒå›³ã®ä¾‹ã«Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒDomainServicesãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹ã®ã‚’ã¿ã‚‹ã¨DBå®Ÿè£…ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’Domain Serviceãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç½®ã‘ã°ã¨ã‚Šã‚ãˆãšè‰¯ã•ãã†ã§ã™ã€‚

Application Serviceã«ã¯Domain Serviceã‚’ä½¿ç”¨ã—é©åˆ‡ã«ãƒ‰ãƒ¡ã‚¤ãƒ³æ“ä½œã®å–ã‚Šã¾ã¨ã‚ã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®å‡¦ç†ã‚’å®Ÿæ–½ã™ã‚Œã°ã‚ˆã•ãã†ã§ã™ã€‚SpringçµŒé¨“è€…ã®æ–¹ã§ã‚ã‚Œã°ã„ã‚ã‚†ã‚‹Serviceã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã‚¯ãƒ©ã‚¹ã§ä¼ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚

ä¸­å¿ƒã®```Domain(Object) Model```ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢ã¨ãªã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«çš„æ¦‚å¿µãŒã“ã“ã«å½“ã¦ã¯ã¾ã‚‹ã§ã—ã‚‡ã†ã€‚ã“ã®éƒ¨åˆ†ã¯æœ€ã‚‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã®ã‚ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãŸã‚ä½•ã«ã‚‚ä¾å­˜ã—ã¦ã„ã¾ã›ã‚“ã€‚

ã¨ãªã‚‹ã¨Controllerã¨å‘¼ã°ã‚Œã‚‹éƒ¨åˆ†ã®å®Ÿè£…ã¯ã©ã“ã‚„ã­ã‚“ã¨ãªã‚‹ã®ã§ã™ãŒã€ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å›³ã‚’è¦‹ã¦ã¿ã‚‹ã¨ä¸€ç•ªå¤–å´ã®user interfaceãƒ¬ã‚¤ãƒ¤ã«ç½®ã‹ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚Controllerã®å®Ÿè£…ãŒinfrastructureã¨åŒã˜ä¸€ç•ªå¤–å´ã«ã‚ã‚‹ã®ã«é•å’Œæ„Ÿã‚’æ„Ÿã˜ã¾ã—ãŸãŒã€ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæå”±ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹å†…ã§ã¯

> CodeCampServerã¯ASP.NET MVC Frameworkã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€SpeakerControllerã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ä¸€éƒ¨ã¨ãªã‚Šã¾ã™ã€‚ ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ASP.NET MVC Frameworkã¨çµåˆã—ã¦ãŠã‚Šã€ã“ã‚Œã‚’å›é¿ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚(æ—¥æœ¬èªè¨³)

ã¨ã‚ã‚Šã¾ã™ã€‚Controllerã®å®Ÿè£…ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«å¼·ãä¾å­˜ã—ã¦ã„ã‚‹ã®ã§ä¸€ç•ªå¤–å´ã«ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚ã“ã‚Œã¯Springã‚„Ruby on Railsã¨ã„ã£ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚‚åŒã˜ã“ã¨ãŒè¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

ã©ã†ã§ã—ã‚‡ã†ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŒå¿ƒå††ã‚ˆã‚Šå®Ÿè£…ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã¤ãã¾ã›ã‚“ã‹ï¼Ÿå‰è¿°ã—ãŸQiitaã®è¨˜äº‹ã«ã‚‚ã‚ã‚Šã¾ã—ãŸãŒå€‹äººçš„ã«ã¯ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®```Use Cases```ãƒ¬ã‚¤ãƒ¤ã¨```Interface Adapters```ãƒ¬ã‚¤ãƒ¤ã«ä½•ã‚’ã©ã“ã«ç½®ã„ãŸã‚‰ã„ã„ã®ã‹ãŒçµæ§‹ã²ã¨ãã‚Œãã‚Œãªæ„ŸãŒã™ã‚‹ã®ã¨åç§°ã‚‚```Presenters```ã‚„```Controller```ã¨ã„ã£ãŸã‚‚ã®ã‚‚ã‚ã‚Šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåç§°ã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ã®ã§**ã“ã‚ŒãŒæ­£è§£ã ã‚ˆ**ã¿ãŸã„ãªã®ãŒãªã„ã®ãŒã‚ã‹ã‚Šã¥ã‚‰ã„ã¨æ€ã£ã¦ã¾ã™ã€‚

ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚ã“ã‚ŒãŒæ­£è§£ã§ã™ã¿ãŸã„ãªã®ã¯å½“ç„¶ãªã„ã®ã§ã™ãŒã€ã¾ã ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚ˆã‚Šã¯é¸æŠè‚¢ãŒå°‘ãªãã‚ã‹ã‚Šã‚„ã™ã„ã‹ãªã¨ã„ã†ã“ã¨ã§ã™ã€‚

## å®Ÿè£…ã—ã¦ã¿ã‚‹

Goã§ç°¡å˜ãªTodo APIã‚’ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ä½œæˆã—ã¾ã™ã€‚

ä½œæˆã—ãŸæˆæœç‰©ã¯ã“ã¡ã‚‰

https://github.com/JY8752/go-onion-architecture-sample

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚Šã¾ã—ãŸã€‚è©³ã—ãã¯å¾Œè¿°ã—ã¾ã™ã€‚

```
.
â”œâ”€â”€ README.md
â”œâ”€â”€ application
â”‚Â Â  â””â”€â”€ service
â”œâ”€â”€ common
â”‚Â Â  â”œâ”€â”€ todo.go
â”‚Â Â  â””â”€â”€ user.go
â”œâ”€â”€ domain
â”‚Â Â  â”œâ”€â”€ model
â”‚Â Â  â””â”€â”€ repository
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ go_onion_architecture.db
â”œâ”€â”€ infrastructure
â”‚Â Â  â”œâ”€â”€ db.go
â”‚Â Â  â””â”€â”€ repository
â”œâ”€â”€ main.go
â”œâ”€â”€ mocks
â”‚Â Â  â”œâ”€â”€ mock_repository
â”‚Â Â  â”œâ”€â”€ registory
â”‚Â Â  â””â”€â”€ service
â”œâ”€â”€ registory
â”‚Â Â  â””â”€â”€ registory.go
â”œâ”€â”€ test
â”‚Â Â  â””â”€â”€ container.go
â”œâ”€â”€ testdata
â”‚Â Â  â””â”€â”€ golden
â””â”€â”€ userinterface
    â”œâ”€â”€ echo.go
    â”œâ”€â”€ handler
    â”œâ”€â”€ request
    â””â”€â”€ response
```

### domain.model

ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å›³ã®æœ€ã‚‚ä¸­å¿ƒã®```Domain Model```ã®éƒ¨åˆ†ã§ã™ã€‚ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

```go:todo.go
package model

import "time"

type TodoId int64
type Title string
type Description string

type Todo struct {
	Id          TodoId      `json:"id"`
	Title       Title       `json:"title"`
	Description Description `json:"description"`
	CreatedAt   time.Time   `json:"created_at"`
	DeleteAt    time.Time   `json:"delete_at"`
}
```

ã“ã‚ŒãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢ã¨ãªã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã«ãªã‚Šã¾ã™ã€‚ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å›³ã®æœ€ã‚‚ä¸­å¿ƒã®æ¦‚å¿µã®ãŸã‚ã©ã“ã«ã‚‚ä¾å­˜ã—ã¦ãŠã‚‰ãšã€ä»–ã®ãƒ¬ã‚¤ãƒ¤ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚

ãã®ãŸã‚ã€ä»–ã®ãƒ¬ã‚¤ãƒ¤ã®å¤‰æ›´ã®å½±éŸ¿ã‚’å—ã‘ãšã€é€†ã«ã“ã®ãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´ã¯ä»–ã®å…¨ã¦ã®ä¾å­˜ãƒ¬ã‚¤ãƒ¤ã«å½±éŸ¿ã‚’ã‚ãŸãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### domain.repository

ã“ã“ã¯```Domain Services```ãƒ¬ã‚¤ãƒ¤ã§ã™ã€‚ãƒ¬ã‚¤ãƒ¤ã®åç§°ã¯Serviceã§ã™ãŒRepositoryã¨ã„ã†åç§°ã«é¦´æŸ“ã¿ãŒã‚ã‚‹ã®ã§domainãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é…ä¸‹ã«repositoryã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’é…ç½®ã—ã¾ã—ãŸã€‚

```go:todo.go
package repository

import "github.com/JY8752/go-onion-architecture-sample/domain/model"

type TodoRepository interface {
	Create(model.UserId, model.Title, model.Description) (model.TodoId, error)
	List(model.UserId) ([]model.Todo, error)
	Delete(model.TodoId) error
}
```

ã“ã®ãƒ¬ã‚¤ãƒ¤ã«ã¯SQLãªã©ã®å…·ä½“çš„ãªå®Ÿè£…ã‚’çŸ¥ã£ã¦ã¯ã„ã‘ãªã„ã®ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ã¿ã‚’é…ç½®ã—ã¾ã™ã€‚

### application.service

ã“ã“ã¯```Application Services```ãƒ¬ã‚¤ãƒ¤ã«ãªã‚Šã¾ã™ã€‚Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ã®æ°¸ç¶šåŒ–ã‚„å–å¾—ãªã©ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ä»Šå›ã®ä¾‹ã§ã¯ã»ã¨ã‚“ã©ãƒ­ã‚¸ãƒƒã‚¯çš„ãªã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã“ã“ã«ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚¸ãƒƒã‚¯çš„ãªã‚‚ã®ãŒãã‚‹æƒ³å®šã§ã™ã€‚

```go:todo.go
package service

import (
	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	"github.com/JY8752/go-onion-architecture-sample/domain/repository"
)

type TodoService interface {
	Create(model.UserId, model.Title, model.Description) (model.TodoId, error)
	List(model.UserId) ([]model.Todo, error)
	Delete(model.TodoId) error
}

type todoService struct {
	todoRep repository.TodoRepository
}

func NewTodoService(todoRep repository.TodoRepository) TodoService {
	return &todoService{
		todoRep: todoRep,
	}
}

func (t *todoService) Create(userId model.UserId, title model.Title, description model.Description) (model.TodoId, error) {
	return t.todoRep.Create(userId, title, description)
}

func (t *todoService) List(userId model.UserId) ([]model.Todo, error) {
	return t.todoRep.List(userId)
}

func (t *todoService) Delete(todoId model.TodoId) error {
	return t.todoRep.Delete(todoId)
}
```

ã“ã®Serviceã‚‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¨å®Ÿè£…ãŒã‚ã‚Šã€é…ç½®å ´æ‰€ã«æ‚©ã‚“ã ã®ã§ã™ãŒä»Šå›ã¯åŒã˜ãƒ¬ã‚¤ãƒ¤ã«é…ç½®ã—ã¾ã—ãŸã€‚ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯å¤–å´ã®ãƒ¬ã‚¤ãƒ¤ã«å®Ÿè£…ã€å†…å´ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã¨ã„ã†ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚‹ã®ã§å†…å´ã®Domain Serviceãƒ¬ã‚¤ãƒ¤ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’é…ç½®ã—ã¦ã‚‚ã„ã„ã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### infrastructure

ä¸€ç•ªå¤–å´ã®ãƒ¬ã‚¤ãƒ¤ã§DBã®å…·ä½“çš„ãªè©³ç´°ã‚’å®Ÿè£…ã™ã‚‹å ´æ‰€ã§ã™ã€‚ä»Šå›ã¯sqlite3ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

```go:todo.go
package infrastructure

import (
	"log"
	"time"

	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	"github.com/JY8752/go-onion-architecture-sample/domain/repository"
	db "github.com/JY8752/go-onion-architecture-sample/infrastructure"
)

type todoRepository struct {
	dbClient *db.DBClient
}

func NewTodoRepository(db *db.DBClient) repository.TodoRepository {
	return &todoRepository{
		dbClient: db,
	}
}

func (t *todoRepository) Create(userId model.UserId, title model.Title, description model.Description) (model.TodoId, error) {
	stmt, err := t.dbClient.Client.Prepare("INSERT INTO todos (user_id, title, description, created_at) VALUES (?, ?, ?, ?)")
	if err != nil {
		return 0, err
	}

	result, err := stmt.Exec(userId, title, description, time.Now())
	if err != nil {
		return 0, err
	}

	id, err := result.LastInsertId()
	if err != nil {
		return 0, err
	}

	return model.TodoId(id), nil
}

func (t *todoRepository) List(id model.UserId) ([]model.Todo, error) {
	stmt, err := t.dbClient.Client.Prepare("SELECT id, title, description, created_at FROM todos WHERE user_id = ? AND delete_at IS NULL")
	if err != nil {
		return nil, err
	}

	rows, err := stmt.Query(id)
	if err != nil {
		return nil, err
	}

	var todos []model.Todo
	for rows.Next() {
		var todo model.Todo
		err = rows.Scan(&todo.Id, &todo.Title, &todo.Description, &todo.CreatedAt)
		if err != nil {
			log.Printf("err: %s\n", err.Error())
			continue
		}
		todos = append(todos, todo)
	}

	return todos, nil
}

func (t *todoRepository) Delete(id model.TodoId) error {
	stmt, err := t.dbClient.Client.Prepare("UPDATE todos SET delete_at = ? WHERE id = ?")
	if err != nil {
		return err
	}

	_, err = stmt.Exec(time.Now(), id)
	if err != nil {
		return err
	}

	return nil
}
```

ã‚‚ã—DBã‚’sqlite3ã‹ã‚‰Mongoã«å¤‰æ›´ã ã£ãŸã‚Šã€ä½¿ç”¨ã™ã‚‹ORMã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã«ãªã£ãŸå ´åˆã«ã“ã®infrastructureã®å®Ÿè£…ã‚’ã¾ã‚‹ã£ã¨ä½œã‚Šæ›¿ãˆã‚‹ã ã‘ã§ã™ã‚€ã‚ˆã†ã«æ„è­˜ã—ã¦å®Ÿè£…ã™ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚

## user interface

ã„ã‚ã‚†ã‚‹Controllerã¨ã—ã¦å®Ÿè£…ã•ã‚Œã‚‹å‡¦ç†ã§ã™ã€‚ä»Šå›ã¯```echo```ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

```go:todo.go
package handler

import (
	"log"

	"github.com/JY8752/go-onion-architecture-sample/common"
	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	"github.com/JY8752/go-onion-architecture-sample/registory"
	"github.com/JY8752/go-onion-architecture-sample/userinterface/request"
	"github.com/JY8752/go-onion-architecture-sample/userinterface/response"
	"github.com/labstack/echo/v4"
)

func TodoHandler(client *echo.Echo, registory registory.Registory) {
	client.POST("/:userId/todos", func(c echo.Context) error {
		// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
		_, err := common.GetUserId(c.Param("userId"))
		if err != nil {
			return err
		}

		var r request.CreateTodoRequest
		if err := c.Bind(&r); err != nil {
			return err
		}

		id, err := registory.TodoService().Create(
			model.UserId(r.UserId),
			model.Title(r.Title),
			model.Description(r.Description),
		)
		if err != nil {
			return err
		}

		return c.JSON(200, response.CreateTodoResponse{Id: id})
	})

	client.GET("/:userId/todos", func(c echo.Context) error {
		userId, err := common.GetUserId(c.Param("userId"))
		if err != nil {
			return err
		}

		todos, err := registory.TodoService().List(userId)
		if err != nil {
			log.Printf("err: %s\n", err.Error())
			return c.JSON(404, []model.Todo{})
		}

		return c.JSON(200, response.GetTodosResponse{Todos: todos})
	})

	client.DELETE("/todos/:id", func(c echo.Context) error {
		todoId, err := common.GetTodoId(c.Param("id"))
		if err != nil {
			return err
		}

		err = registory.TodoService().Delete(todoId)
		if err != nil {
			return err
		}

		return c.NoContent(204)
	})
}
```

ã“ã“ãŒä¸€ç•ªæ‚©ã‚“ã ã‚“ã§ã™ãŒãªã‚‹ã¹ãechoã‚’åˆ‡ã‚Šæ¨ã¦ã‚„ã™ãã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€ã©ã†ã—ã¦ã‚‚echoã®å®Ÿè£…ã«ä¾å­˜ã—ã¦ã—ã¾ã†ã®ã§çµæœçš„ã«ã“ã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã‚Šã¾ã—ãŸãŒã‚‚ã£ã¨ã„ã„æ„Ÿã˜ã®å®Ÿè£…ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€ãŸã¶ã‚“ã€‚

### registory

ã“ã“ã¯ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯é–¢ä¿‚ãªã„ã®ã§ã™ãŒã€echoã®handleré–¢æ•°ã‹ã‚‰Service -> Repositoryã¨å‘¼ã³å‡ºã—ã¦ã„ãã®ã«ä¾å­˜é–¢ä¿‚ã®æ³¨å…¥ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã€ãã®ãŸã‚ã®DIã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…ã§ã™ã€‚

Springãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã‚‰ã°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å´ãŒã„ã„æ„Ÿã˜ã«ã‚„ã£ã¦ãã‚Œã¾ã™ãŒGoã®å ´åˆè‡ªä½œã™ã‚‹ã‹[wire](https://github.com/google/wire)ãªã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```go:registory.go
package registory

import (
	service "github.com/JY8752/go-onion-architecture-sample/application/service"
	repository "github.com/JY8752/go-onion-architecture-sample/domain/repository"
	db "github.com/JY8752/go-onion-architecture-sample/infrastructure"
	infrastructure "github.com/JY8752/go-onion-architecture-sample/infrastructure/repository"
)

type Registory interface {
	UserRep() repository.UserRepository
	UserService() service.UserService
	TodoRep() repository.TodoRepository
	TodoService() service.TodoService
}

type registory struct {
	dbClient *db.DBClient
}

func NewRegistory(db *db.DBClient) Registory {
	return &registory{
		dbClient: db,
	}
}

func (r *registory) UserRep() repository.UserRepository {
	return infrastructure.NewUserRepository(r.dbClient)
}

func (r *registory) UserService() service.UserService {
	return service.NewUserService(r.UserRep())
}

func (r *registory) TodoRep() repository.TodoRepository {
	return infrastructure.NewTodoRepository(r.dbClient)
}

func (r *registory) TodoService() service.TodoService {
	return service.NewTodoService(r.TodoRep())
}
```

registoryã®å®Ÿè£…ã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸€ç•ªå¤–å´ã‚‚ã—ãã¯å††ã®å¤–å´ã‹ã‚‰å…¨ã¦ã®ãƒ¬ã‚¤ãƒ¤ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚å®Ÿè£…ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://moneyforward-dev.jp/entry/2021/03/08/go-test-mock/

### main

ã“ã‚Œã§ã ã„ãŸã„å®Ÿè£…ã¯å®Œäº†ã§ã™ã€‚æœ€å¾Œã«mainé–¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```go:main.go
package main

import (
	db "github.com/JY8752/go-onion-architecture-sample/infrastructure"
	"github.com/JY8752/go-onion-architecture-sample/registory"
	ui "github.com/JY8752/go-onion-architecture-sample/userinterface"
)

func main() {
	// db
	db := db.NewDBClient("./go_onion_architecture.db")
	defer db.Client.Close()

	// registory
	registory := registory.NewRegistory(db)

	// echo
	apiClient := ui.NewApiClient(registory)
	apiClient.RegisterRoute()
	apiClient.Start()
}
```

### ãã®ä»–

ä»Šå›ã€å…±é€šå‡¦ç†çš„ãªã‚‚ã®ã‚’```common```ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—é…ç½®ã—ã¾ã—ãŸãŒã€ã“ã®ã‚ˆã†ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯ä¾‹å¤–çš„ã«ä¸€ç•ªå¤–å´ã®ãƒ¬ã‚¤ãƒ¤ã«ã—ã¾ã—ãŸã€‚

ãŸã ã€å‘¼ã³å‡ºã—å´ãŒå…¨ã¦ã“ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã¨ãã‚‚ãã‚‚ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½œã‚‹ã‹ä½œã‚‰ãªã„ã‹ã¿ãŸã„ãªè©±ã«ãªã‚Šãã†ãªã®ã§ã“ã‚Œã‚‚é©åˆ‡ã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

Clean Architectureæœ¬ã«ã¯ã“ã®ã‚ˆã†ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¯**ã‚ã‚‰ã‚†ã‚‹ç®‡æ‰€ã‹ã‚‰å‘¼ã°ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚å®‰å®šåº¦ãŒé«˜ãã€æŠ½è±¡åº¦ã¯ä½ãã€å¤‰æ›´ãŒã•ã‚Œã«ãã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã§ã‚ã‚‹ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

ã‚‚ã—ã‹ã—ãŸã‚‰ã€ç½®ãã«ã—ã¦ã‚‚ä¸­å¿ƒã®domainãƒ¬ã‚¤ãƒ¤ã«ç½®ãæ–¹ãŒé©åˆ‡ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚ã¨ã¯ã€configç³»ã‚„å®šæ•°ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©ã‚’ã©ã“ã«ç½®ãã‹ã¿ãŸã„ãªè©±ãŒå®Ÿãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯å‡ºã¦ããã†ã§ã™ãŒåŸºæœ¬çš„ã«ã¯**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨ã¯ç„¡é–¢ä¿‚ã§å¤‰æ›´ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã‚‚ã®ã¯å¤–å´ã«ã€ãã†ã§ãªã‘ã‚Œã°å†…å´**ã«ç½®ãã‚ˆã†ãªæ„è­˜ã§å®Ÿè£…ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆã‚’æ›¸ã

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚„ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦ãã‚Œãã‚Œã®ãƒ¬ã‚¤ãƒ¤ã§ãƒ†ã‚¹ãƒˆãŒæ›¸ãã‚„ã™ããªã‚‹ã¨ã„ã£ãŸç‚¹ãŒã‚ã‚‹ã®ã§ãƒ†ã‚¹ãƒˆã‚‚æ›¸ã„ã¦ã„ãã¾ã™ã€‚

Clean Architectureæœ¬ã«ã€Œ**ãƒ†ã‚¹ãƒˆã‚‚ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€éƒ¨ã§ã‚ã‚Šã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å®Ÿè£…ã«å¼·ãä¾å­˜ã—ã¦ã„ã‚‹**ã€ã¨ã‚ã‚Šã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã«ä¾å­˜ã—ã¦ã„ã‚Œã°å½“ç„¶ã€å®Ÿè£…ã«å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã«ãƒ†ã‚¹ãƒˆã‚‚å½±éŸ¿ã‚’å—ã‘ã‚‹ãŸã‚ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã§ã¦ãã¾ã™ã€‚

**ãƒ†ã‚¹ãƒˆãŒã™ãå£Šã‚Œã‚‹**ã¨è¨€ã‚ã‚Œã‚‹ã®ã¯ã“ã®ã‚ˆã†ãªç†ç”±ã‹ã‚‰ã§ã—ã‚‡ã†ã€‚ãã®ãŸã‚ã€ãƒ†ã‚¹ãƒˆã‚’å£Šã‚Œã«ããã™ã‚‹ãŸã‚ã«ãªã‚‹ã¹ãå®Ÿè£…ã«ä¾å­˜ã—ãªã„ã‚ˆã†ã«ã™ã‚‹æ–¹ãŒã„ã„ã¨è‘—è€…ã¯æ€ã£ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€**mock**ã‚’ä½¿ãŠã†ã­ã¨ã„ã†ã“ã¨ã§ã™ã€‚

mockã‚’ä½¿ã†ä½¿ã‚ãªã„ã¯æ„è¦‹ãŒã‚ã‹ã‚Œã‚‹ã¨ã“ã‚ã§ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€è‘—è€…ã¯ä¸Šè¨˜ã®ã‚ˆã†ãªç†ç”±ã‹ã‚‰**ä»–ã®ãƒ¬ã‚¤ãƒ¤ã¸ã®ä¾å­˜é–¢ä¿‚ã¯mockã«ã—ã€ãã®ãƒ¬ã‚¤ãƒ¤ã®è²¬å‹™ã«ã®ã¿ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦å˜ä½“ãƒ†ã‚¹ãƒˆã‚’æ›¸ã**ã“ã¨ã«ã—ã¦ã„ã¾ã™ã€‚

### infrastructureã®ãƒ†ã‚¹ãƒˆ

ä»Šå›ã¯sqlite3ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã®DBã‚’ãƒ†ã‚¹ãƒˆç”¨ã«èµ·å‹•ã—ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```go:todo_test.go
package infrastructure_test

import (
	"os"
	"testing"

	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	"github.com/JY8752/go-onion-architecture-sample/domain/repository"
	db "github.com/JY8752/go-onion-architecture-sample/infrastructure"
	infrastructure "github.com/JY8752/go-onion-architecture-sample/infrastructure/repository"
	"github.com/stretchr/testify/assert"
)

var todoRep repository.TodoRepository

func TestMain(m *testing.M) {
	d := db.NewDBClient("file:infrastructure_test_db?mode=memory")
	todoRep = infrastructure.NewTodoRepository(d)

	code := m.Run()

	d.Client.Close() // Exitã™ã‚‹ã¨deferãŒå®Ÿè¡Œã•ã‚Œãªã„ã®ã§
	os.Exit(code)
}

func TestCreate(t *testing.T) {
	// when
	userId := model.UserId(1)
	id, err := todoRep.Create(userId, "title", "description")
	if err != nil {
		t.Fatal(err)
	}

	// then
	todos, err := todoRep.List(userId)
	if err != nil {
		t.Fatal(err)
	}

	assert.Equal(t, 1, len(todos))
	assert.Equal(t, id, todos[0].Id)
	assert.Equal(t, model.Title("title"), todos[0].Title)
	assert.Equal(t, model.Description("description"), todos[0].Description)
}
```

ã‚‚ã—ã€MySQLãªã©ã®DBã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹å ´åˆã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ãƒ»åœæ­¢ã‚’ã‚³ãƒ¼ãƒ‰ä¸Šã§æ‰±ãˆã‚‹dockertestãªã©ãŒãŠã™ã™ã‚ã§ã™ã€‚

ã‚‚ã—èˆˆå‘³ãŒã‚ã‚Œã°ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“

https://zenn.dev/jy8752/articles/419ab77b2b6a61

### serviceã®ãƒ†ã‚¹ãƒˆ

ã“ã“ã§ã¯Repositoryã®å®Ÿè£…ã«ä¾å­˜ã—ãŸããªã„ã®ã§Repositoryã¯mockã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»Šå›ã¯gomockã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

```go:todo_test.go
package service_test

import (
	"testing"

	"github.com/JY8752/go-onion-architecture-sample/application/service"
	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	"github.com/JY8752/go-onion-architecture-sample/mocks/mock_repository"
	"github.com/golang/mock/gomock"
	"github.com/stretchr/testify/assert"
)

func TestCreate(t *testing.T) {
	// given
	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	m := mock_repository.NewMockTodoRepository(ctrl)

	m.EXPECT().Create(gomock.Any(), gomock.Any(), gomock.Any()).Return(model.TodoId(1), nil)

	ts := service.NewTodoService(m)

	// when
	result, err := ts.Create(1, model.Title("title"), model.Description("description"))
	if err != nil {
		t.Fatal(err)
	}

	// when
	assert.Equal(t, model.TodoId(1), result)
}
```

### handlerã®ãƒ†ã‚¹ãƒˆ

ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆåŒæ§˜ã€ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…ã«ä¾å­˜ã—ãŸããªã„ã®ã§mockã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```go:user_test.go
package handler_test

import (
	"net/http/httptest"
	"strings"
	"testing"

	"github.com/JY8752/go-onion-architecture-sample/domain/model"
	mock_registory "github.com/JY8752/go-onion-architecture-sample/mocks/registory"
	mock_service "github.com/JY8752/go-onion-architecture-sample/mocks/service"
	"github.com/JY8752/go-onion-architecture-sample/userinterface/handler"
	"github.com/golang/mock/gomock"
	"github.com/labstack/echo/v4"
	"github.com/sebdah/goldie/v2"
	"github.com/stretchr/testify/assert"
)

const (
	goldenDir = "../../testdata/golden/"
)

func TestCreateUserHandler(t *testing.T) {
	// given
	e := echo.New()

	ctrl := gomock.NewController(t)
	defer ctrl.Finish()

	// ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç™»éŒ²
	service := mock_service.NewMockUserService(ctrl)
	service.EXPECT().Create("user1").Return(model.UserId(1), nil)

	registory := mock_registory.NewMockRegistory(ctrl)
	registory.EXPECT().UserService().Return(service)

	handler.CreateUserHandler(e, registory)

	// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
	body := `{"name": "user1"}`
	w := httptest.NewRecorder()
	r := httptest.NewRequest(echo.POST, "/users", strings.NewReader(body))
	r.Header.Set(echo.HeaderContentType, echo.MIMEApplicationJSON)
	defer r.Body.Close()

	// when
	e.ServeHTTP(w, r)

	// then
	assert.Equal(t, 200, w.Code)
	g := goldie.New(t, goldie.WithFixtureDir(goldenDir))
	g.Assert(t, t.Name(), w.Body.Bytes())
}
```

handlerã®ãƒ†ã‚¹ãƒˆã¯golden testã§å®Ÿè£…ã—ã¾ã—ãŸã€‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®JSONã®é …ç›®ãŒå¢—ãˆã¦ãã‚‹ã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤§å¤‰ãªãŸã‚æœŸå¾…ã™ã‚‹æƒ…å ±ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã§ãã‚‹golden testã¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã§æ¥½ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã—ãŸã€‚

Goã§golden testã‚’æ›¸ããŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã—ãŸãŒä»Šå›ã¯[goldie](https://github.com/sebdah/goldie/tree/master/v2)ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

## ã¾ã¨ã‚

ä½•åº¦ã‚‚è¨€ã†ã‚ˆã†ã§ã™ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚‚é‡è¦ãªã“ã¨ã¯ãƒ¬ã‚¤ãƒ¤ã‚’åˆ†ã‘ã‚‹ã“ã¨ã¨ãã‚Œãã‚Œã®ãƒ¬ã‚¤ãƒ¤ã®ä¾å­˜é–¢ä¿‚ã®æ–¹å‘ã§ã™ã€‚ç›®çš„ã¯é–¢å¿ƒã”ã¨ã®åˆ†é›¢ã§ã‚ã‚Š**å¤‰æ›´ã«å¼·ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚‹ã“ã¨**ã§ã™ã€‚

ãã®ãŸã‚ã€å…·ä½“çš„ãªã“ã‚ŒãŒæ­£è§£ã§ã™ã¨ã„ã£ãŸã‚‚ã®ã¯ãªããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„çµ„ç¹”ã€ä½¿ç”¨ã™ã‚‹è¨€èªã«ã‚ˆã£ã¦ã‚‚ä½œã‚Šæ–¹ã¯å¤‰ã‚ã£ã¦ã„ãã¨æ€ã„ã¾ã™ã€‚

æŠ½è±¡çš„ãªæ¦‚å¿µãªã®ã§å®Œå…¨ã«ç†è§£ã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãŸã‚ã€ã¾ãšã¯è‡ªåˆ†ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ç´å¾—æ„Ÿã®ã‚ã‚‹ã‚‚ã®ã‚’ã¾ãšã¯ä½œã£ã¦ã¿ã‚‹ã¨ç†è§£ã«ã¤ãªãŒã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã¨ã«ã‹ãã€é‡è¦ã ãªã¨æ€ã£ãŸã“ã¨ã¯**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„DBãªã©å¤–éƒ¨ä¾å­˜ã®éƒ¨åˆ†ã¯ã„ã¤ã§ã‚‚æ¨ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹**ã“ã¨ã§ã™ã€‚ã¾ãŸã€æ¦‚å¿µã‚’ç†è§£ã—ãªã‘ã‚Œã°å®Ÿè£…ã—ã¦ã„ã¦ã‚‚è…‘ã«è½ã¡ãªã„ã¨æ€ã„ã¾ã™ã®ã§Clean Architecutureæœ¬ã‚’ã¾ã èª­ã‚“ã ãªã„æ–¹ã¯ãœã²èª­ã‚“ã§ã¿ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

ä»Šå›ã¯ä»¥ä¸Šã§ã™ğŸ¼