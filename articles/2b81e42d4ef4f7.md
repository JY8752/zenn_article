---
title: "localstackã®lambdaã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¹ãƒˆã‚¢ã®å€¤ã‚’å–å¾—ã™ã‚‹æ™‚ã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["localstack", "lambda", "AWS"]
published: false
---
ä»¥ä¸‹ã®ã‚ˆã†ãªdocker-composeã§localstackã‚’èµ·å‹•ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¹ãƒˆã‚¢ã«æ¥ç¶šã™ã‚‹ã‚ˆã†ãªlambdaé–¢æ•°ã‚’ä½œæˆã—ãŸã¨ã“ã‚ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸã€‚
```docker:docker-compose.yml
version: "3.8"
services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=lambda, secretmanager
      - DATA_DIR=/tmp/localstack/data
      - LAMBDA_EXECUTOR=docker-reuse
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
```

## Could not connect to the endpoint URL
ä¸Šè¨˜ã®docker-composeã§localstackã‚’èµ·å‹•ã—ã€lambdaé–¢æ•°ã‚’å®Ÿè¡Œã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¹ãƒˆã‚¢ã‹ã‚‰å€¤ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚

```terminal
  "errorMessage": "Could not connect to the endpoint URL: \"http://localhost:4566/\"",
  "errorType": "EndpointConnectionError",
```

ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã€‚

```diff docker:docker-compose.yml
version: "3.8"
services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=lambda, secretmanager
      - DATA_DIR=/tmp/localstack/data
      - LAMBDA_EXECUTOR=docker-reuse
      - DOCKER_HOST=unix:///var/run/docker.sock
+     - LAMBDA_DOCKER_NETWORK=host
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
```

## listen tcp :9001: bind: address already in use
ä»Šåº¦ã¯ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚

```terminal
{
  "errorMessage": "Lambda process returned with error. Result: . Output:\n2022/08/16 14:48:35 listen tcp :9001: bind: address already in use",
  "errorType": "InvocationException",
```

ä»¥ä¸‹ã®è¡Œã‚’ä¿®æ­£ã€‚

```diff docker:docker-compose.yml
version: "3.8"
services:
  localstack:
    image: localstack/localstack:latest
    container_name: localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=lambda, secretmanager
      - DATA_DIR=/tmp/localstack/data
-      - LAMBDA_EXECUTOR=docker-reuse
+      - LAMBDA_EXECUTOR=docker
      - DOCKER_HOST=unix:///var/run/docker.sock
      - LAMBDA_DOCKER_NETWORK=host
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
```

ã“ã‚Œã§localstackã‹ã‚‰èµ·å‹•ã—ãŸlambdaã‹ã‚‰ä»–ã®AWSãƒªã‚½ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã‚‹ã€‚