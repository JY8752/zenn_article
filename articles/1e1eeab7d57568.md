---
title: "Spring boot(kotlin) + gRPCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§timeoutã‚’è¨­å®šã™ã‚‹æ–¹æ³•"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Spring", "kotlin", "Java", "gRPC"]
published: true
---

Spring boot(kotlin)ã§gRPCã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã„ã¦timeoutã‚’è¨­å®šã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã£ã¦ã“ãªã„ã¾ã¾ã„ã‚ã‚†ã‚‹ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«ãªã£ã¦ãƒãƒã£ãŸã®ã§ãã®å‚™å¿˜éŒ²ã§ã™ã€‚

## å•é¡Œ
ä¸‹è¨˜ã®ã‚ˆã†ã«gRPCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã„ãŸã¨ã“ã‚ã€ã‚ã‚‹ãƒ†ã‚¹ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¦ãã®ã¾ã¾ãƒ—ãƒ­ã‚»ã‚¹ãŒçµ‚äº†ã›ãšãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«ãªã£ã¦ã„ãŸã€‚

```kotlin
val channel = ManagedChannelBuilder.forAddress("localhost", 6565)
            .intercept(MetadataClientInterceptor())
            .usePlaintext().build()

val stub = HelloGrpcKt.HelloCoroutineStub(channel)

val response = async { stub.helloRpc(Empty.getDefaultInstance(), metadata) }
```

## è§£æ±ºç­–
stubã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹æ™‚ã«timeoutã®è¨­å®šã‚’ã™ã‚‹ã€‚
ä¸‹è¨˜ã®ä¾‹ã ã¨10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ã€‚

```diff kotlin
val channel = ManagedChannelBuilder.forAddress("localhost", 6565)
            .intercept(MetadataClientInterceptor())
            .usePlaintext().build()

- val stub = HelloGrpcKt.HelloCoroutineStub(channel)
+ val stub = HelloGrpcKt.HelloCoroutineStub(channel, CallOptions.DEFAULT.withDeadline(Deadline.after(10), TimeUnit.SECONDS))

val response = async { stub.helloRpc(Empty.getDefaultInstance(), metadata) }
```

ä»¥ä¸Šï¼