---
title: "Go x gRPC„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆCI„Å´Ëá™Âãï„ÉÜ„Çπ„Éà+ÈùôÁöÑËß£Êûê(staticcheck)„ÇíÂ∞éÂÖ•„Åô„Çã"
emoji: "üëã"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["Go", "CI", "GithubActions", "test", "staticcheck"]
published: true
---

:::message
„Åì„ÅÆË®ò‰∫ã„ÅÆgRPC„Å´„Å§„ÅÑ„Å¶„ÅÆË™¨Êòé„ÅåÂ∞ë„ÅóÂè§„Åè„Å™„Å£„Å¶„Åç„Åæ„Åó„Åü„ÄÇprotoc„Å´‰ª£„Çè„ÇãBuf„Å®„ÅÑ„ÅÜ„ÉÑ„Éº„É´„Å´„Å§„ÅÑ„Å¶Êú¨„ÇíÊõ∏„ÅÑ„Åü„ÅÆ„Åß„Çà„Åë„Çå„Å∞„Åì„Å°„Çâ„ÇÇ„ÅîÂèÇÁÖß„Åè„Å†„Åï„ÅÑ„ÄÇ

https://zenn.dev/jy8752/books/33743f8091c39d
:::

gRPC„Çí‰ΩøÁî®„Åó„ÅüGo„ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆCI„Å´„ÉÜ„Çπ„Éà„Å®ÈùôÁöÑËß£Êûê„ÇíÁµÑ„ÅøËæº„Çì„Åß„Åø„Åü„ÅÆ„Åß„Åù„ÅÆÂÇôÂøòÈå≤„Åß„Åô

ÊúÄÁµÇÁöÑ„Å™yml„Éï„Ç°„Ç§„É´„ÅØ„Åì„Çì„Å™ÊÑü„Åò

‰ΩúÊàê„Åó„Åü„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅØ[„Åì„Å°„Çâ](https://github.com/JY8752/gacha-app)


```yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
        # protoc
        - name: Set up protoc
          run: |
            curl -OL https://github.com/google/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip \
            && unzip protoc-3.19.4-linux-x86_64.zip -d protoc3 \
            && sudo mv protoc3/bin/* /usr/local/bin/ \
            && sudo mv protoc3/include/* /usr/local/include/ \
        # protoc-gen-go
        - name: Install protoc-gen-go
          run: |
            go install github.com/golang/protobuf/protoc-gen-go@latest \
            && go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
        # proto„Éï„Ç°„Ç§„É´generate
        - name: Generate gRPC code
          run: |
            mkdir -p pkg/grpc && protoc --go_out=./pkg/grpc --go_opt=paths=source_relative \
            --go-grpc_out=./pkg/grpc --go-grpc_opt=paths=source_relative \
            -I=./proto \
            proto/**/*.proto
        # staticcheck„Ç§„É≥„Çπ„Éà„Éº„É´
        - name: Install staticcheck
          run: go install honnef.co/go/tools/cmd/staticcheck@latest
        # build
        - name: Build
          run: go build
        # test
        - name: Test
          run: go test ./...
        # ÈùôÁöÑËß£Êûê
        - name: Staticcheck
          run: staticcheck ./...
```

# proto„Éï„Ç°„Ç§„É´„ÅÆ„Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åô„Çã

gRPC„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÂ†¥Âêà„ÄÅproto„Éï„Ç°„Ç§„É´„Åã„Çâ„Ç≥„Éº„Éâ„ÇíËá™ÂãïÁîüÊàê„Åô„Çã„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇÁîüÊàêÂæå„ÅÆ„Ç≥„Éº„Éâ„Çí„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Ç≥„Éº„Éâ„Å®‰∏ÄÁ∑í„Å´push„Åó„Å¶„ÅÑ„Çå„Å∞ÂïèÈ°å„Å™„ÅÑ„Åß„Åô„Åå„ÄÅpush„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅCI‰∏ä„Åß„ÉÜ„Çπ„Éà„ÇíÂÆüË°å„Åô„Çã„Å´„ÅØproto„Éï„Ç°„Ç§„É´„Åã„ÇâÁîüÊàê„Åó„Åü„Ç≥„Éº„Éâ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ

„Åæ„Åö„ÄÅGo„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Å´.github/workflows/ci.yml„Çí‰ΩúÊàê„Åó‰ª•‰∏ã„ÇíË®òËºâ„ÄÇ

```yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
```

chackout„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åß„ÅØproto„ÇíÂà•„É™„Éù„Ç∏„Éà„É™„ÅßÁÆ°ÁêÜ„Åó„Å¶„ÅÑ„Å¶„Çµ„Éñ„É¢„Ç∏„É•„Éº„É´„Åß‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà‰ª•‰∏ã„ÅÆË®òËºâ„Çí„Åô„Çã„Åì„Å®„Åß‰∏ÄÁ∑í„Å´checkout„Åó„Å¶„Åè„Çå„Çã„ÄÇ

```
          with:
            submodules: recursive
```

proto„Éï„Ç°„Ç§„É´„Åã„Çâ„Ç≥„Éº„Éâ„ÇíËá™ÂãïÁîüÊàê„Åô„Çã„ÅÆ„Å´protoc„Å®‰ª•‰∏ã„ÅÆGo„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„ÄÇ

- github.com/golang/protobuf/protoc-gen-go@latest
- google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest

```diff yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
+        # protoc
+        - name: Set up protoc
+          run: |
+            curl -OL https://github.com/google/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip \
+            && unzip protoc-3.19.4-linux-x86_64.zip -d protoc3 \
+            && sudo mv protoc3/bin/* /usr/local/bin/ \
+            && sudo mv protoc3/include/* /usr/local/include/ \
+        # protoc-gen-co
+        - name: Install protoc-gen-go
+          run: |
+            go install github.com/golang/protobuf/protoc-gen-go@latest \
+            && go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

„Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åô„Çã

```diff yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
        # protoc
        - name: Set up protoc
          run: |
            curl -OL https://github.com/google/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip \
            && unzip protoc-3.19.4-linux-x86_64.zip -d protoc3 \
            && sudo mv protoc3/bin/* /usr/local/bin/ \
            && sudo mv protoc3/include/* /usr/local/include/ \
        # protoc-gen-go
        - name: Install protoc-gen-go
          run: |
            go install github.com/golang/protobuf/protoc-gen-go@latest \
            && go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
+        # proto„Éï„Ç°„Ç§„É´generate
+        - name: Generate gRPC code
+          run: |
+            mkdir -p pkg/grpc && protoc --go_out=./pkg/grpc --go_opt=paths=source_relative \
+            --go-grpc_out=./pkg/grpc --go-grpc_opt=paths=source_relative \
+            -I=./proto \
+            proto/**/*.proto
```

# staticcheck„Çí„Ç§„É≥„Çπ„Éà„Éº„É´

Go„ÅÆÈùôÁöÑËß£Êûê„Å®„Åó„Å¶‰ª•Ââç„ÅØgolint„Åå‰Ωø„Çè„Çå„Å¶„ÅÑ„Åü„Çà„ÅÜ„Åß„Åô„Åå„É°„É≥„ÉÜ„Åï„Çå„Å™„Åè„Å™„Å£„Åü„Çà„ÅÜ„Åß‰ªä„ÅØstaticcheck„Åå‰Ωø„Çè„Çå„Å¶„ÅÑ„Çã„ÅÆ„ÅåÂ§ö„Åù„ÅÜ„Å™„ÅÆ„Åß„Åì„Å°„Çâ„ÇíÂà©Áî®

staticcheck

https://staticcheck.io/

yml„Éï„Ç°„Ç§„É´„Å´‰ª•‰∏ã„ÇíËøΩË®ò

```diff yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
        # protoc
        - name: Set up protoc
          run: |
            curl -OL https://github.com/google/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip \
            && unzip protoc-3.19.4-linux-x86_64.zip -d protoc3 \
            && sudo mv protoc3/bin/* /usr/local/bin/ \
            && sudo mv protoc3/include/* /usr/local/include/ \
        # protoc-gen-go
        - name: Install protoc-gen-go
          run: |
            go install github.com/golang/protobuf/protoc-gen-go@latest \
            && go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
        # proto„Éï„Ç°„Ç§„É´generate
        - name: Generate gRPC code
          run: |
            mkdir -p pkg/grpc && protoc --go_out=./pkg/grpc --go_opt=paths=source_relative \
            --go-grpc_out=./pkg/grpc --go-grpc_opt=paths=source_relative \
            -I=./proto \
            proto/**/*.proto
+        # staticcheck„Ç§„É≥„Çπ„Éà„Éº„É´
+        - name: Install staticcheck
+          run: go install honnef.co/go/tools/cmd/staticcheck@latest
```

# „ÉÜ„Çπ„Éà„Å®ÈùôÁöÑËß£Êûê„ÅÆÂÆüË°å

‰ª•‰∏ã„Çíyml„Éï„Ç°„Ç§„É´„Å´ËøΩË®ò

```diff yaml:ci.yml
name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: app
    steps:
        # proto„ÇÇ„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        - uses: actions/checkout@v3
          with:
            submodules: recursive
        # go„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        - name: Set up golang
          uses: actions/setup-go@v3
          with:
            go-version: '>=1.18.4'
        # protoc
        - name: Set up protoc
          run: |
            curl -OL https://github.com/google/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip \
            && unzip protoc-3.19.4-linux-x86_64.zip -d protoc3 \
            && sudo mv protoc3/bin/* /usr/local/bin/ \
            && sudo mv protoc3/include/* /usr/local/include/ \
        # protoc-gen-go
        - name: Install protoc-gen-go
          run: |
            go install github.com/golang/protobuf/protoc-gen-go@latest \
            && go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
        # proto„Éï„Ç°„Ç§„É´generate
        - name: Generate gRPC code
          run: |
            mkdir -p pkg/grpc && protoc --go_out=./pkg/grpc --go_opt=paths=source_relative \
            --go-grpc_out=./pkg/grpc --go-grpc_opt=paths=source_relative \
            -I=./proto \
            proto/**/*.proto
        # staticcheck„Ç§„É≥„Çπ„Éà„Éº„É´
        - name: Install staticcheck
          run: go install honnef.co/go/tools/cmd/staticcheck@latest
+        # build
+        - name: Build
+          run: go build
+        # test
+        - name: Test
+          run: go test ./...
+        # ÈùôÁöÑËß£Êûê
+        - name: Staticcheck
+          run: staticcheck ./...
```

‰ª•‰∏äÔºÅ