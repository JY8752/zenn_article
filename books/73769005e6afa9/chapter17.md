---
"title": "おわりに"
---

本書では「単体テストの考え方/使い方」で論じられている古典学派の考え方に基づくアーキテクチャやテストの考え方をGoのプロジェクトで実践する内容としました。

筆者はエンジニアとしてのキャリアのスタートをJavaで始めているため、その影響もあるかもしれませんが以下のようなレイヤーに分類したコードを書いていました。

```go
type UserController struct {
	us UserService
}

type UserService interface {}

type userService struct {
	ur UserRepository
}

type UserRepository interface {}

type userRepository struct {
	db *sql.DB
}

func (us *userService) Create() {
  // UserRepositoryの呼び出し

  // なんかロジック

  // UserRepositoryの呼び出し
}

func (uc *UserController) Create() {
  // UserService呼び出し
}
```

```Controller -> Service -> Repository```といったように順に処理を呼び出し、ビジネスロジックは全て**Service層**で扱うような意識で開発をしていました。そして、このような構成を綺麗に保つために**クリーンアーキテクチャ**のようなアーキテクチャが最適であるとも考えていました。

このようなコードを書いていると**Service層が膨れ上がり、テストをするのが困難である**ときが多くあり、その解決に**モック**を多用していました。

そのため、「単体テストの考え方/使い方」を読み進めている時、モックを使用しない古典学派を推奨する考えに疑問を抱いていましたが書籍内で述べられている**モックを使用したテストは複雑な依存関係をモックで解決するが本来そのような複雑な依存関係を構築しなければならない設計の悪さを見ないふりしているだけ**だという主張に衝撃を受けました。もしかしたら、このような考えはよく知られた考えだったのかもしれませんが少なくとも筆者にとっては衝撃でした。

今まで実践してきた開発手法が否定されることになりましたが、すぐに受け入れることはできました。というのも、それまでモックを多用してテストを書いてきたために依存関係の解決は格段に楽にっていましたが**リファクタリングのたびにテストが壊れ**、テストの保守コストに苦しんでいたからかもしれません。

これはモックを使用したテストは実装と深く結びつき、偽陽性を多く生み出してしまったためにリファクタリングへの耐性が備わっていないテストになってしまっていたのでしょう。

今までの開発手法をリセットし「単体テストの考え方/使い方」で学んだ内容を取り入れるために開発手法を再考したく本書を執筆いたしました。

本書がテストやアーキテクチャについて悩まれている開発者の方の参考になれば幸いです。また、本書の間違い、解釈違い、ご意見あればぜひぜひお気軽にコメント、ご連絡ください！

最後までお読みいただきありがとうございました🐼