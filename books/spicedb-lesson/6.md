---
title: "分散システムとしてのSpiceDB"
---

SpiceDBが大規模サービスにおいても高速に動作するために分散システムとして設計されていることは前回までの章でも触れてきました。
この章では分散システムとして設計されたSpiceDBのクラスターの構成についてもう少し詳しく解説します。

## Dispatch

**Dispatch**はSpiceDBのアーキテクチャの中でも重要な役割を担っています。既に説明してきたようにSpiceDBクラスター内の各ノードは問い合わせがあったPermissionの内容をキャッシュとして保持しています。SpiceDBがリクエストを受け取るとどこかのノードにキャッシュがある可能性があるため、他のノードに問い合わせをします。この他のノードへキャッシュの問い合わせをする機構がDispatchです。

以下は[公式ドキュメント](https://authzed.com/docs/spicedb/concepts/dispatch#architecture-diagram)に記載のSpiceDBのアーキテクチャ図です。

![](https://storage.googleapis.com/zenn-user-upload/b38effa3d248-20250530.png)

## Dispatchの設定

Kubernetes環境でDispatchの設定をするには**SpiceDB Operator**の使用が推奨されています。SpiceDB Operatorを使用することでDispatchは自動で設定されます。

非Kubernetes環境においてもDispatchを有効にすることは可能ですがDNSの更新に依存しているため、DNSの変更があった場合にDispatchが機能しなくなる可能性があります。そのため、SpiceDBの利用ではKubernetes環境の使用やマネージドのSpiceDB環境の利用が推奨されています。

:::message
SpiceDBの公式ドキュメントを読んでいるといたるところで推奨環境がKubernetesであることの記載がされています。それは本章で説明したような高パフォーマンスを実現するための分散システムとしてSpiceDBを動かすためにはKubernetes環境が必要だからでしょう。しかし、Kubernetes環境の開発になれていない開発者であればAWSのECSやGoogle CloudのCloud RunなどでSpiceDBを動かしたと思うかもしれません。SpiceDBはdockerイメージとして公開されているためECSやCloud RunでSpiceDBを動かすことは可能です。以下のAuthZedのテックブログでECS環境でSpiceDBを動かす例が紹介されているため興味がある方は読んでみることをおすすめします。

https://authzed.com/blog/spicedb-amazon-ecs
:::

## まとめ

- SpiceDBは大規模サービスに対応するため、分散システムとして設計されている。
- DispatchはSpiceDBのアーキテクチャで重要な役割を果たし、ノード間でキャッシュを問い合わせる機能を持つ。
- Kubernetes環境ではSpiceDB Operatorを使用することでDispatchの設定が自動化される。
- 非Kubernetes環境でもDispatchを有効にできるが、DNSの更新に依存するため注意が必要。
