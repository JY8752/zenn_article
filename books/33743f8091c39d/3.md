---
title: "Bufの基本とBuf CLIのインストール"
---

この章ではBufについての解説とBuf CLIのインストールをしていきます。

## Bufとは

以下、公式ドキュメントより(翻訳文)

> Bufの目標は、API開発をスキーマ主導のパラダイムへとシフトさせ、サービス所有者とクライアントが信頼できる方法でAPIが定義される未来への道を開くことである。

> IDLを使用してAPIを定義すると、単にREST/JSONサービスを公開するよりも多くの利点があり、今日、Protobufは業界で最も安定し、広く採用されているIDLです。しかし現状では、Protobufを使用することは、データ転送形式としてJSONを使用するよりもはるかに困難です。

> Bufは、Protobufが技術的なメリットにおいて明白な選択肢であることを維持しながら、サービスオーナーやクライアントにとって信頼性が高く使いやすいものにするためのツールを構築しています。ProtobufのAPIを効率的かつ効果的に作成、維持、利用するために、お客様の組織が車輪を再発明する必要はありません。弊社がProtobuf管理戦略を代行しますので、お客様は重要なことに集中できます。

上記のようにBufはProtobufを使用したスキーマ開発を強く支持しており、そのために真に必要なツールを開発・提供してくれています。具体的には以下のような課題があると主張しています。

- APIの一貫性がないことが多い
- 依存関係の管理がコピペ（JSで言うnpmのようなパッケージマネージャーのような仕組みがない）
- Protobufの前方・後方互換性の強制力がない
- Protobufファイルとスタブの配布が難しい
- エコシステムが標準化されておらず、ユーザーフレンドリーでもない

Bufはこれらの課題を解決するために大きく2つのツールおよびサービスを提供しています。

## Buf CLI

Buf CLIはBufが開発したProtobufを最適に標準化されたプラクティスで開発するためのコマンドラインインターフェースです。Buf CLIは以下のような特徴を持ちます。

>- 高性能なProtobufコンパイラ。
>- 優れたAPI設計の選択と構造を強制するリンター。
>- ソースコードまたはワイヤレベルでの互換性を強制する変更検出器。
>- 設定可能なテンプレートに基づいてprotocプラグインを呼び出すコードジェネレータ。

Buf CLIはprotocとは別の自作コンパイラを内蔵しておりこれは**protocのビルドより約2倍速い**。そして、```buf lint```や```buf format```といったコマンドでリンターとフォーマット機能を提供し、Protobufに一貫性を提供します。また、```buf breaking```を使用することで破壊的変更を検知することを可能とし```buf.gen.yaml```という設定ファイルにprotocプラグインの設定を切り出すことで```buf generate```という簡潔なコマンドでコード生成を可能とします。

## BSR

BSRはProtobuf APIのホスティングSaaSプラットフォームです。DockerでいうところのDocker Hubと思っていただいて問題ないです。BSRを利用することでProtobufモジュールを公開することができ、公開されたモジュールを自由に使うことができる。これは既に多くのエコシステムやプラグインが公開されているのに加え、プロダクト内でのスタブの配布も容易にすることが可能。

公開されたProtobufモジュールは以下の二つの特徴を持つ。

- **リモートプラグイン** ローカルにProtobufプラグインをインストールする必要がない。
- **SDKの生成** BSRはモジュールを公開する際にSDKを生成し、各プログラミング言語のモジュールとして使用することができる。

例えば以下は```googleapis/googleapis```として公開されているProtobufモジュールです。

https://buf.build/googleapis/googleapis

## Buf CLIのインストール

Buf CLIのインストールにはHomebrew, npm, Dockerなどがあるので好きな方法でインストールしてください。今回はHomebrewを使用してインストールしました。

https://buf.build/docs/installation

```
brew install bufbuild/buf/buf

% buf --version
1.29.0
```

## Buf CLIのエディタ拡張

Buf CLIを使用しているコードエディタに統合することでより早いフィードバックを得ることができ、開発生産性を高めることができます。

対応エディタはVimやVSCode、JetBrainsなどがあります。

https://buf.build/redirect?redirect_url=%2Fdocs%2Feditor-integration

筆者はVSCodeを使用しているのでVSCodeの[Buf拡張](https://marketplace.visualstudio.com/items?itemName=bufbuild.vscode-buf)をインストールしました。